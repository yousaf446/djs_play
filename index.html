<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>DJ Map</title>

    <link href="http://code.jquery.com/ui/1.10.4/themes/smoothness/jquery-ui.min.css" rel="stylesheet" type="text/css" />

    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

    <!-- Optional theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

    <!-- Latest compiled and minified JQuery -->
    <script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
    <script src="http://code.jquery.com/ui/1.10.4/jquery-ui.min.js"></script>
    <!-- Latest compiled and minified Bootstrap JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

    <script src="https://maps.googleapis.com/maps/api/js?libraries=places,geometry&key=AIzaSyA7xY6JgrR-hAOLs1ZmZU9vCoFNb_YQ7qI"></script>

    <script src="dj_venue.js"></script>

    <script type="text/javascript">
        var marker = [];
        var map;
        var mapOptions = {
            zoom: 10,
            mapTypeId: google.maps.MapTypeId.ROADMAP,
            center: new google.maps.LatLng(-31.9505, 115.8605)
        };

        var mark_counter = 0;

        var infowindow = new google.maps.InfoWindow();

        function initialize() {
            map = new google.maps.Map(document.getElementById("map_canvas"),
                    mapOptions);

            var address_bar = (document.getElementById('address_bar'));
            var address = (document.getElementById('address'));
            var autocomplete = new google.maps.places.Autocomplete(address);

            google.maps.event.addListener(autocomplete, 'place_changed', function() {
                var place = autocomplete.getPlace();
                if (!place.geometry) {
                    return;
                }
                map.setCenter(place.geometry.location);
                map.setZoom(10);
            });

            map.controls[google.maps.ControlPosition.LEFT_TOP].push(address_bar);
            getGeoJSON();
        }

        function getGeoJSON() {

            var dj_bounds = new google.maps.LatLngBounds();

            for(var i in djVenue) {
                if(djVenue[i].Latitude != "0.000000000") {
                    console.log(djVenue[i]);
                    var coordinates = new google.maps.LatLng(djVenue[i].Latitude, djVenue[i].Longitude);

                    marker[mark_counter] = new google.maps.Marker({
                        position: coordinates,
                        map: map,
                        id: mark_counter,
                        name: djVenue[i].VenueName,
                        address: djVenue[i].VenueAddress,
                        artist: djVenue[i].ArtistName,
                        event: djVenue[i].EventName,
                        date: djVenue[i].Date

                    });

                    dj_bounds.extend(marker[mark_counter].getPosition());

                    google.maps.event.addListener(marker[mark_counter], "click", function (event) {
                        var content = "Venue Name: <b>" + this.name + "</b><br/>Venue Address: <b>" + this.address + "</b><br/>";
                        content += "Artist Name: <b>" + this.artist + "</b><br/>Event Name: <b>" + this.event + "</b><br/>";
                        content += "Event Date: <b>" + this.date + "</b>";
                        infowindow.setContent(content);
                        infowindow.setPosition(this.getPosition());
                        infowindow.open(map);
                    });
                    mark_counter++;
                }
            }

            map.fitBounds(dj_bounds);
        }

        google.maps.event.addDomListener(window, 'load', initialize);
    </script>
</head>
<body>
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container-fluid">
        <div class="navbar-header">
            <a class="navbar-brand" href="">DJ Venue Map</a>
        </div>
    </div>
</nav>
<div class="input-group col-md-4" id="address_bar">
    <input type="text" class="form-control" style="margin: 20px" id="address" name="address" placeholder="Search Address" />
</div>
<div id="map_canvas" style="position: absolute !important;width: 100%; height: 100%"></div>
</body>
</html>